<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Probabilistic modeling ¬∑ UnderwaterAcoustics.jl</title><meta name="title" content="Probabilistic modeling ¬∑ UnderwaterAcoustics.jl"/><meta property="og:title" content="Probabilistic modeling ¬∑ UnderwaterAcoustics.jl"/><meta property="twitter:title" content="Probabilistic modeling ¬∑ UnderwaterAcoustics.jl"/><meta name="description" content="Documentation for UnderwaterAcoustics.jl."/><meta property="og:description" content="Documentation for UnderwaterAcoustics.jl."/><meta property="twitter:description" content="Documentation for UnderwaterAcoustics.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">UnderwaterAcoustics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="uw_basic.html">Underwater acoustics</a></li><li><a class="tocitem" href="pm_basic.html">Propagation modeling toolkit</a></li><li><a class="tocitem" href="pm_envref.html">Environmental model reference</a></li><li><a class="tocitem" href="pm_api.html">Propagation modeling API</a></li></ul></li><li><span class="tocitem">Propagation models</span><ul><li><a class="tocitem" href="pm_pekeris.html">PekerisRayModel</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href="tut_turing.html">Probabilistic modeling</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Dataset"><span>Dataset</span></a></li><li><a class="tocitem" href="#Probabilistic-model"><span>Probabilistic model</span></a></li><li><a class="tocitem" href="#Variational-inference"><span>Variational inference</span></a></li></ul></li><li><a class="tocitem" href="tut_autodiff.html">Differentiable modeling</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="tut_turing.html">Probabilistic modeling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tut_turing.html">Probabilistic modeling</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/org-arl/UnderwaterAcoustics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/org-arl/UnderwaterAcoustics.jl/blob/master/docs/src/tut_turing.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Probabilistic-modeling"><a class="docs-heading-anchor" href="#Probabilistic-modeling">Probabilistic modeling</a><a id="Probabilistic-modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Probabilistic-modeling" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This tutorial is based on the example presented in the UComms 2020 webinar talk &quot;<a href="https://www.facebook.com/watch/live/?v=2473971036238315">Underwater Acoustics in the age of differentiable and probabilistic programming</a>&quot;.</p></div></div><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>Let us consider a geoacoustic inversion problem where we have a static omnidirectional broadband acoustic source transmitting in a 5-7 kHz band. A single omnidirectional receiver picks up the signal at a fixed range, but profiles the water column, and therefore makes transmission loss measurements at various depths. We would like to estimate seabed parameters from these transmission loss measurements.</p><h2 id="Dataset"><a class="docs-heading-anchor" href="#Dataset">Dataset</a><a id="Dataset-1"></a><a class="docs-heading-anchor-permalink" href="#Dataset" title="Permalink"></a></h2><p>To illustrate this idea, let us generate a synthetic dataset for a known set of seabed parameters (relative density <code>œÅ</code> = 1.5, relative soundspeed <code>c</code> = 1.2, and attenuation <code>Œ¥</code> = 0.001).</p><p>The environment is assumed to be an isovelocity and with a constant depth of 20 m. The source is at a depth of 5 m. The receiver is at a range of 100 m from the source, and makes measurements at depths from 10 to 19 m in steps of 1 m.</p><p><img src="images/tut_turing_1.png" alt/></p><p>Since we have an range-independent isovelocity environment, we can use the <code>PekerisRayModel</code> (otherwise we could use the <code>RaySolver</code>):</p><pre><code class="language-julia hljs">using UnderwaterAcoustics
using DataFrames

function ùí¥(Œ∏)
  r, d, f, œÅ, c, Œ¥ = Œ∏
  env = UnderwaterEnvironment(seabed = RayleighReflectionCoef(œÅ, c, Œ¥))
  tx = AcousticSource(0.0, -5.0, f)
  rx = AcousticReceiver(r, -d)
  pm = PekerisRayModel(env, 7)
  transmissionloss(pm, tx, rx)
end

data = [
  (depth=d, frequency=f, xloss=ùí¥([100.0, d, f, 1.5, 1.2, 0.001]))
  for d ‚àà 10.0:1.0:19.0, f ‚àà 5000.0:100.0:7000.0
]
data = DataFrame(vec(data))</code></pre><h2 id="Probabilistic-model"><a class="docs-heading-anchor" href="#Probabilistic-model">Probabilistic model</a><a id="Probabilistic-model-1"></a><a class="docs-heading-anchor-permalink" href="#Probabilistic-model" title="Permalink"></a></h2><p>We use some very loose uniform priors for <code>œÅ</code>, <code>c</code> and <code>Œ¥</code>, and estimate the transmission loss using the same model ùí¥, as used in the data generation, but without information on the actual seabed parameters. We assume that the measurements of transmission loss are normally distributed around the modeled transmission loss, with a covariance of 0.5 dB.</p><p>We define the probabilistic model as a <a href="https://github.com/TuringLang/Turing.jl"><code>Turing.jl</code></a> model:</p><pre><code class="language-julia hljs">using Turing

# depths d, frequencies f, transmission loss measurements x
@model function geoacoustic(d, f, x)
  œÅ ~ Uniform(1.0, 3.0)
  c ~ Uniform(0.5, 2.5)
  Œ¥ ~ Uniform(0.0, 0.003)
  Œº = [ùí¥([100.0, d[i], f[i], œÅ, c, Œ¥]) for i ‚àà 1:length(d)]
  x ~ MvNormal(Œº, 0.5)
end</code></pre><h2 id="Variational-inference"><a class="docs-heading-anchor" href="#Variational-inference">Variational inference</a><a id="Variational-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Variational-inference" title="Permalink"></a></h2><p>Once we have the model defined, we can run Bayesian inference on it. We could either use MCMC methods from Turing, or variational inference. Since our model is differentiable, we choose to use the automatic differentiation variational inference (ADVI):</p><pre><code class="language-julia hljs">using Turing: Variational

q = vi(
  geoacoustic(data.depth, data.frequency, data.xloss),
  ADVI(100, 10000)
)</code></pre><p>The returned <code>q</code> is a 3-dimensional posterior probability distribution over the parameters <code>œÅ</code>, <code>c</code> and <code>Œ¥</code>. We can estimate the mean of the distribution by drawing random variates and taking the sample mean:</p><pre><code class="language-julia-repl hljs">julia&gt; mean(rand(q, 10000); dims=2)
3√ó1 Array{Float64,2}:
 1.4989510476936188
 1.2000012848664092
 0.0009835578241605488</code></pre><p>We see that the estimated parameter means for <code>œÅ</code>, <code>c</code> and <code>Œ¥</code> are quite close to the actual values used in generating the data.</p><p>We can also plot the conditional distributions of each parameter:</p><pre><code class="language-julia-repl hljs">using StatsPlots

plot(œÅ -&gt; pdf(q, [œÅ, 1.2, 0.001]), 1.3, 1.7; xlabel=&quot;œÅ&quot;)
plot(c -&gt; pdf(q, [1.5, c, 0.001]), 1.1, 1.3; xlabel=&quot;c&quot;)
plot(Œ¥ -&gt; pdf(q, [1.5, 1.2, Œ¥]), 0.0, 0.003; xlabel=&quot;Œ¥&quot;)</code></pre><p><img src="images/tut_turing_2.png" alt/> <img src="images/tut_turing_3.png" alt/> <img src="images/tut_turing_4.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="pm_pekeris.html">¬´ PekerisRayModel</a><a class="docs-footer-nextpage" href="tut_autodiff.html">Differentiable modeling ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 2 April 2024 08:41">Tuesday 2 April 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
